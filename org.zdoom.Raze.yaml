app-id: org.zdoom.Raze
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: '23.08'
command: raze.sh

finish-args:
# Controller support on SteamDeck and such (copied from GZDoom)
  - --device=all
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --share=network
  - --socket=pulseaudio

# Based on Raze
# We redirect the original ~/.config/raze
  - --persist=.config/raze

# Simpler way of preventing KDE related errors
  - --env=KDE_FULL_SESSION=false

cleanup:
  - /include
  - '*.a'
  - '*.la'
  - /lib/pkgconfig

modules:

  - shared-modules/linux-audio/libinstpatch.json
  - shared-modules/linux-audio/fluidsynth2.json
  - shared-modules/gzdoom/game-music-emu.json
  - shared-modules/gzdoom/zmusic.json

  - name: raze
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DSYSTEMINSTALL=1
    sources:
      - type: git
        url: https://github.com/ZDoom/Raze.git
        tag: 1.11.0
        commit: 19e5f308de065fb432beb9d11070ece12da3ea3c
      - type: script
        commands:
          - raze +fluid_patchset /app/share/games/raze/soundfonts/raze.sf2 "$@"
        dest-filename: raze.sh
      - type: file
        path: org.zdoom.Raze.desktop
      - type: file
        path: org.zdoom.Raze.metainfo.xml
      - type: file
        path: org.zdoom.Raze.256.png
    post-install:
      - install -Dm 644 soundfont/raze.sf2 /app/share/games/raze/soundfonts/raze.sf2
      - install -D raze.sh /app/bin/raze.sh
      - install -Dm 644 org.zdoom.Raze.desktop -t /app/share/applications
      - install -Dm 644 org.zdoom.Raze.256.png /app/share/icons/hicolor/256x256/apps/org.zdoom.Raze.png
      - install -Dm 644 org.zdoom.Raze.metainfo.xml /app/share/metainfo/org.zdoom.Raze.metainfo.xml
